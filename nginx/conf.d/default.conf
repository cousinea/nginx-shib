server {

    listen 		80;
    server_name nginx-shib.openshift.dsc.umich.edu;
    
    location / {
    	root 	html;
    	index	index.html index.htm;
    }

    # FastCGI authorizer for Auth Request module
    location = /shibauthorizer {
        internal;
        include 		fastcgi_params;
        fastcgi_pass 	unix:/tmp/shibauthorizer.sock;
    }

    # FastCGI responder
    location /saml {
        include 		fastcgi_params;
        #fastcgi_param  	HTTPS on;
        #fastcgi_param  	SERVER_PORT 443;
        #fastcgi_param  	SERVER_PROTOCOL https;
        #fastcgi_param  	X_FORWARDED_PROTO https;
        #fastcgi_param  	X_FORWARDED_PORT 443;
        fastcgi_pass 	unix:/tmp/shibresponder.sock;
    }

    # Resources for the Shibboleth error pages. This can be customised.
    location /shibboleth-sp {
        alias 			/etc/shibboleth/;
    }
    
	location /secure {
	    fastcgi_pass	ruby-sample.openshift.dsc.umich.edu;
       	more_clear_input_headers -t 'Variable-*' 'Shib-*' 'Remote-User' 'REMOTE_USER' 'Auth-Type' 'AUTH_TYPE';
       	shib_request 	/shibauthorizer;
       	shib_request_use_headers on;
    }    
}
